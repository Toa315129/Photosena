<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SENA PHOTOBOOTH</title>

<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#fdfaf4;      
  --blue:#a7d8f7;    
  --pink:#ffd6e8;    
  --text:#333333;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{
  height:100%;background:var(--bg);
  font-family:"Quicksand",sans-serif;
  display:flex;align-items:center;justify-content:center;
}
.container{
  width:100%;max-width:960px;
  background:var(--bg);
  border-radius:18px;
  padding:18px;
  border:5px solid var(--blue);
  position:relative;
}

/* header */
.header{text-align:center;margin-bottom:20px;position:relative;}
.brand-box{
  display:inline-block;
  padding:12px 24px;
  background:var(--blue);
  border-radius:8px;
}
.brand{
  font-size:42px;font-weight:700;
  color:#fff;
  text-transform:uppercase;
  letter-spacing:2px;
}

/* หน้าเลือกจำนวนรูป */
.choose{
  display:flex;
  justify-content:center;
  gap:18px;
  margin-top:40px;
}
.choice{
  width:100px;height:140px;
  background:#fff;
  border:3px solid var(--blue);
  border-radius:12px;
  display:flex;
  align-items:center;justify-content:center;
  font-size:20px;font-weight:700;
  color:var(--text);
  cursor:pointer;
  transition:all 0.2s ease;
}
.choice:hover{background:var(--pink);color:#fff;}

/* กล้อง */
.main{display:none;flex-direction:column;align-items:center;gap:18px;}
.preview{
  width:100%;max-width:480px;
  border-radius:14px;overflow:hidden;
  background:#fff;border:4px solid var(--blue);
  aspect-ratio:3/4;position:relative;
}
#video{width:100%;height:100%;object-fit:cover;transform:scaleX(-1);}
.countdown{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:4rem;color:var(--pink);font-weight:700;
}
.flash{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none;transition:opacity 0.18s}
.flash.show{opacity:0.85}

/* controls */
.controls{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:12px}
.btn{
  padding:10px 14px;border-radius:12px;border:2px solid var(--blue);
  background:#fff;color:var(--text);font-weight:600;cursor:pointer;
  transition:all 0.2s ease;font-family:"Quicksand",sans-serif;
}
.btn:hover:not(:disabled){background:var(--pink);color:#fff;}
.btn:disabled{opacity:0.55;cursor:not-allowed}
.shutter{
  width:80px;height:80px;border-radius:50%;
  background:#fff;border:5px solid var(--blue);
  display:inline-flex;align-items:center;justify-content:center;
  cursor:pointer;
  margin-top:10px;
}
.shutter:hover{background:var(--pink);}
.gallery{margin-top:20px;display:flex;gap:10px}
.thumb{width:90px;aspect-ratio:3/4;border:3px solid var(--blue);border-radius:12px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center}
.thumb img{width:100%;height:100%;object-fit:cover;}

</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand-box"><div class="brand">SENA PHOTOBOOTH</div></div>
  </div>

  <!-- หน้าแรก เลือกจำนวนรูป -->
  <div id="start" class="choose">
    <div class="choice" data-n="2">2</div>
    <div class="choice" data-n="4">4</div>
    <div class="choice" data-n="6">6</div>
  </div>

  <!-- กล้อง -->
  <div id="main" class="main">
    <div class="preview">
      <video id="video" autoplay playsinline></video>
      <div class="countdown" id="countdown"></div>
      <div class="flash" id="flash"></div>
    </div>
    <div class="controls">
      <div class="shutter" id="shutter"></div>
      <button class="btn" id="retake" disabled>ถ่ายใหม่</button>
      <button class="btn" id="download" disabled>ดาวน์โหลด</button>
    </div>
    <div class="gallery" id="thumbs"></div>
  </div>
</div>

<audio id="snap" src="https://cdn.jsdelivr.net/gh/naptha/talkdemo/snap.mp3" preload="auto"></audio>

<script>
const start=document.getElementById('start');
const main=document.getElementById('main');
const video=document.getElementById('video');
const shutter=document.getElementById('shutter');
const retakeBtn=document.getElementById('retake');
const downloadBtn=document.getElementById('download');
const countdownEl=document.getElementById('countdown');
const flash=document.getElementById('flash');
const snap=document.getElementById('snap');
const thumbs=document.getElementById('thumbs');

let captures=[],totalShots=3,stream=null;

async function startCamera(){
  if(stream){stream.getTracks().forEach(t=>t.stop());}
  try{
    stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}});
    video.srcObject=stream;
  }catch(e){alert("ไม่สามารถเปิดกล้องได้");}
}
function captureFrame(){
  const c=document.createElement('canvas');
  c.width=video.videoWidth;c.height=video.videoHeight;
  const ctx=c.getContext('2d');
  ctx.translate(c.width,0);ctx.scale(-1,1);
  ctx.drawImage(video,0,0,c.width,c.height);
  return c.toDataURL('image/png');
}
function showCount(n){countdownEl.textContent=n;}
function hideCount(){countdownEl.textContent='';}
function doFlash(){snap.play().catch(()=>{});flash.classList.add('show');setTimeout(()=>flash.classList.remove('show'),170);}

async function takeSequence(){
  captures=[]; thumbs.innerHTML='';
  retakeBtn.disabled=true;downloadBtn.disabled=true;
  for(let i=0;i<totalShots;i++){
    for(let s=3;s>=1;s--){showCount(s);await new Promise(r=>setTimeout(r,1000));}
    hideCount();doFlash();
    const data=captureFrame();
    captures.push(data);
    const div=document.createElement('div');
    div.className='thumb';div.innerHTML=`<img src="${data}">`;
    thumbs.appendChild(div);
    if(i<totalShots-1) await new Promise(r=>setTimeout(r,1000));
  }
  retakeBtn.disabled=false;downloadBtn.disabled=false;
}

shutter.addEventListener('click',takeSequence);
retakeBtn.addEventListener('click',()=>{captures=[];thumbs.innerHTML='';downloadBtn.disabled=true;retakeBtn.disabled=true;});
downloadBtn.addEventListener('click',()=>{
  if(!captures.length) return;
  const a=document.createElement('a');
  a.href=captures[0];
  a.download="photobooth.png";
  a.click();
});
document.querySelectorAll('.choice').forEach(c=>{
  c.addEventListener('click',()=>{
    totalShots=parseInt(c.dataset.n)||3;
    start.style.display='none'; main.style.display='flex';
    startCamera();
  });
});
</script>
</body>
</html>
