<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Booth</title>
<style>
:root {
  --blue: #e6f3ff;
  --dark: #222;
  --shadow: 0 4px 10px rgba(0,0,0,0.15);
}
body {
  margin: 0;
  font-family: sans-serif;
  background: white;
  color: var(--dark);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
section {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}
section.active { display: flex; }

/* Layout Page */
#layout-page button {
  margin: 10px;
  padding: 20px 40px;
  border: none;
  border-radius: 8px;
  background: var(--blue);
  font-size: 1.2rem;
  cursor: pointer;
  box-shadow: var(--shadow);
  transition: 0.2s;
}
#layout-page button:hover { transform: scale(1.05); }

/* Capture Page */
#video {
  width: 90%;
  max-width: 400px;
  border-radius: 12px;
  background: black;
}
#countdown {
  position: absolute;
  font-size: 5rem;
  font-weight: bold;
  color: var(--dark);
  text-align: center;
}
.capture-controls {
  position: relative;
  margin-top: 20px;
}
#capture-btn {
  width: 80px; height: 80px;
  border-radius: 50%;
  border: none;
  background: var(--blue);
  box-shadow: var(--shadow);
  cursor: pointer;
}
.small-btn {
  position: absolute;
  top: -10px;
  font-size: 1.5rem;
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--dark);
}
#flip-btn { left: -50px; }
#retry-btn { right: -50px; }

/* Download Page */
#photos {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin: 20px;
}
.polaroid {
  background: white;
  padding: 8px;
  box-shadow: var(--shadow);
}
.polaroid img {
  display: block;
  width: 100%;
  border-radius: 4px;
}
#download-page button {
  margin: 10px;
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  background: var(--blue);
  cursor: pointer;
  box-shadow: var(--shadow);
}
</style>
</head>
<body>

<!-- Layout Page -->
<section id="layout-page" class="active">
  <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ</h2>
  <button onclick="startCapture(2)">2 ‡∏£‡∏π‡∏õ</button>
  <button onclick="startCapture(4)">4 ‡∏£‡∏π‡∏õ</button>
  <button onclick="startCapture(6)">6 ‡∏£‡∏π‡∏õ</button>
</section>

<!-- Capture Page -->
<section id="capture-page">
  <video id="video" autoplay playsinline></video>
  <div id="countdown"></div>
  <div class="capture-controls">
    <button id="flip-btn" class="small-btn">üîÑ</button>
    <button id="capture-btn"></button>
    <button id="retry-btn" class="small-btn">üîÅ</button>
  </div>
</section>

<!-- Download Page -->
<section id="download-page">
  <h2>‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
  <div id="photos"></div>
  <button onclick="downloadAll()">Download</button>
  <button onclick="window.print()">Print</button>
</section>

<script>
let video = document.getElementById('video');
let countdownEl = document.getElementById('countdown');
let captureCount = 0, totalPhotos = 0;
let photos = [];

async function startCapture(num) {
  totalPhotos = num;
  photos = [];
  captureCount = 0;
  showPage('capture-page');
  let stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
}

function showPage(id) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function countdown(cb) {
  let count = 3;
  countdownEl.textContent = count;
  let timer = setInterval(() => {
    count--;
    countdownEl.textContent = count > 0 ? count : "";
    if(count <= 0) { clearInterval(timer); cb(); }
  }, 1000);
}

document.getElementById('capture-btn').onclick = () => {
  countdown(() => {
    let canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    photos.push(canvas.toDataURL());
    captureCount++;
    if (captureCount >= totalPhotos) {
      showDownload();
    }
  });
};

function showDownload() {
  showPage('download-page');
  let container = document.getElementById('photos');
  container.innerHTML = "";
  photos.forEach(src => {
    let div = document.createElement('div');
    div.className = 'polaroid';
    div.innerHTML = `<img src="${src}">`;
    container.appendChild(div);
  });
}

function downloadAll() {
  photos.forEach((src, i) => {
    let a = document.createElement('a');
    a.href = src;
    a.download = `photo_${i+1}.png`;
    a.click();
  });
}
</script>
</body>
</html>
